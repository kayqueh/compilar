name: Distribuir alterações para empresas
on:
  push:
    branches:
      - desativado
jobs:
  clone:
    runs-on: ubuntu-latest
    steps:
      - name: Trabalho sujo
        env:
          GITHUB_TOKEN: ${{ secrets.API_TOKEN_GITHUB }}
          GIT_ASKPASS: /bin/true
          GIT_AUTHOR_NAME: "kayqueh"
          GIT_AUTHOR_EMAIL: "kayque@brcore.com.br"
          GIT_COMMITTER_NAME: "kayqueh"
          GIT_COMMITTER_EMAIL: "kayque@brcore.com.br"
        run: |
          git clone https://$GITHUB_TOKEN@github.com/kayqueh/populate-app.git
          for dest in "populate-app-empresa-teste" "populate-app-empresa-teste2"; do
            rm -rf temp_folder
            git clone https://$GITHUB_TOKEN@github.com/kayqueh/$dest.git temp_folder
            cd populate-app
            git checkout Empresa
            git rm app.json
            git rm eas.json
            git commit -m "Remove app.json e eas.json"
            cp ../temp_folder/app.json .
            cp ../temp_folder/eas.json .
            git add app.json eas.json
            git commit -m "Adicionar app.json e eas.json no repositório de destino"
            git push --force https://$GITHUB_TOKEN@github.com/kayqueh/$dest.git Empresa:main
            cd ..
          done
